# 13. Подключим чатбота к базе данных

- Мы должны ходить в БД не только при сохранении города, но и когда пользователь говорит “Узнать погоду”.

- Мы должны проверить, есть ли в БД строчка, соответствующая этому юзеру.

Обновите блок запроса погоды:

```python
# ...
elif text == 'Узнать погоду':

    # пытаемся достать город из базы данных
    city_from_db = City.query.filter_by(username=username).first()

    # если он есть - достаем имя и запрашиваем погоду
    if city_from_db:
        city_name = city_from_db.city_name
        reply = get_weather(city_name)
    else:
        reply = 'Сначала установи город.'
# ...
```

---
# Задание 

Проверьте все сценарии:

- Города можно сохранять
- Города можно изменять
- Изменения отражаются в БД
- Запрос погоды работает.
